<!DOCTYPE html>
<html>
<head>
    <title>Quiz</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #001; color: cyan; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .box { border: 1px solid cyan; padding: 20px; margin: 10px; width: 90%; text-align: center; border-radius: 10px; }
        .opt { background: #003; border: 1px solid cyan; padding: 10px; margin: 5px; width: 100%; cursor: pointer; display: none; }
        .start { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>
    <div id="start" class="start"><button onclick="startQuiz()" style="padding:20px; font-size:20px;">START QUIZ (20 XP)</button></div>
    
    <div id="qBox" class="box">Loading...</div>
    <div id="opts"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;
        
        const questions = [
            {q: "Hawa Mahal kahan hai?", o: ["Delhi", "Jaipur", "Agra", "Mumbai"], a: "Jaipur"},
            {q: "IPL 2008 kisne jeeta?", o: ["CSK", "MI", "RR", "KKR"], a: "RR"},
            {q: "Human body mein kitni bones hoti hain?", o: ["206", "208", "300", "105"], a: "206"},
            {q: "Samsung kis desh ki company hai?", o: ["China", "USA", "Japan", "South Korea"], a: "South Korea"},
            {q: "Sholay movie mein Gabbar kaun tha?", o: ["Amjad Khan", "Amrish Puri", "Pran", "Prem Chopra"], a: "Amjad Khan"}
        ];
        
        let curr = 0;
        let score = 0;

        function startQuiz() {
            fetch('/api/deduct_fee', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ user_id: userId, amount: 20, game_name: 'Quiz' })
            }).then(r=>r.json()).then(d=>{
                if(d.status=='success') {
                    document.getElementById('start').style.display = 'none';
                    nextQ();
                } else tg.showAlert(d.msg);
            });
        }

        function nextQ() {
            if(curr >= questions.length) {
                if(score > 0) {
                    fetch('/api/claim_win', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ user_id: userId, amount: score, game_name: 'Quiz' })
                    });
                }
                tg.showAlert(`Quiz Over! Won: ${score} XP`);
                tg.close();
                return;
            }

            let q = questions[curr];
            document.getElementById('qBox').innerText = `Q${curr+1}: ${q.q}`;
            document.getElementById('opts').innerHTML = "";
            
            // 2 Second Wait for Options
            setTimeout(() => {
                q.o.forEach(opt => {
                    let b = document.createElement('div');
                    b.className = 'opt';
                    b.innerText = opt;
                    b.onclick = () => check(opt, q.a);
                    document.getElementById('opts').appendChild(b);
                    b.style.display = 'block';
                });
            }, 2000);
        }

        function check(ans, real) {
            document.getElementById('opts').innerHTML = "<h2 style='color:yellow'>Checking...</h2>";
            
            // 5 Second Hype for Result
            setTimeout(() => {
                if(ans === real) {
                    score += 20;
                    tg.showAlert("✅ Sahi Jawab!");
                } else {
                    tg.showAlert("❌ Galat! Sahi tha: " + real);
                }
                curr++;
                nextQ();
            }, 5000);
        }
    </script>
</body>
</html>